name: CI Pipeline - Website and Arduino Compilation Check

on:
  push:
    branches:
      - main # Trigger the workflow on pushes to the 'main' branch
  pull_request:
    branches:
      - main # Trigger the workflow on pull requests targeting 'main'

jobs:
  # Job 1: Check if the website compiles
  website-compile:
    name: Check Website Compilation
    runs-on: ubuntu-latest

    steps:
      # Step 1: Check out the repository code
      - name: Checkout Code
        uses: actions/checkout@v3

      # Step 2: Set up the Node.js environment
      - name: Set Up Node.js Environment
        uses: actions/setup-node@v3
        with:
          node-version: 16

      # Step 3: Install dependencies
      - name: Install Dependencies
        run: npm install

      # Step 4: Build/Compile the project
      - name: Build Website
        run: npm run build

  # Job 2: Check if Arduino sketches compile
  arduino-compile:
    name: Compile Arduino Sketches
    runs-on: ubuntu-latest

    steps:
      # Step 1: Check out the repository code
      - name: Checkout Code
        uses: actions/checkout@v3

      # Step 2: Install Arduino CLI
      - name: Install Arduino CLI
        run: |
          curl -fsSL https://raw.githubusercontent.com/arduino/arduino-cli/master/install.sh | sh
          arduino-cli config init

      # Step 3: Install Arduino core and libraries
      - name: Install Arduino Cores and Libraries
        run: |
          arduino-cli core update-index
          arduino-cli core install arduino:avr # Install AVR core for Arduino boards

      # Step 4: Compile all `.ino` files
      - name: Compile Arduino Sketches
        run: |
          for sketch in $(find . -name "*.ino"); do
            echo "Compiling $sketch..."
            arduino-cli compile --fqbn arduino:avr:uno $sketch
          done
